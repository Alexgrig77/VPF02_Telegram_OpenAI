# Telegram бот с OpenAI через ProxyAPI

Telegram-бот на Python с использованием библиотеки aiogram и OpenAI API через ProxyAPI.

## Возможности

- Интеграция с OpenAI через ProxyAPI (модель o4-mini-2025-04-16)
- Запоминание контекста диалога для каждого пользователя
- Очистка контекста по команде
- **Работа со специальными промптами** - выбор из предустановленных промптов для структурированных ответов
- Обработка ошибок и логирование

## Установка

1. Клонируйте репозиторий или скачайте файлы проекта

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `env_example.txt` и заполните токены:
```bash
BOT_TOKEN=ваш_токен_telegram_бота
OPENAI_API_KEY=ваш_ключ_proxyapi
```

   Для получения токенов:
   - **BOT_TOKEN**: Получите у [@BotFather](https://t.me/BotFather) в Telegram
   - **OPENAI_API_KEY**: Получите на [proxyapi.ru](https://proxyapi.ru)

## Запуск

```bash
python bot.py
```

## Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/clear` или `/reset` - Очистить контекст диалога

Также можно очистить контекст, написав "очистить контекст" в чате.

## Работа со специальными промптами

При первом обращении к боту вам будет предложено использовать специальные промпты:

1. **Выбор режима работы**: Введите "да" для использования промптов или "нет" для обычного режима
2. **Выбор промпта**: Если выбрали "да", бот покажет список доступных промптов с номерами
3. **Использование промпта**: Введите номер промпта (например, "1", "2" и т.д.)
4. **Работа с промптом**: После выбора промпта все ваши вопросы будут обрабатываться с использованием выбранного промпта

**Доступные промпты** (хранятся в `prompts.json`):
- Анализ текста
- Генерация кода
- Перевод и локализация
- Планирование проекта
- Решение математических задач
- Создание контента
- Анализ данных
- Обучение и объяснение
- Диагностика проблем
- Стратегическое планирование

Выбранный промпт сохраняется для пользователя до очистки контекста. Для отмены выбора промпта используйте команду `/clear`.

## Структура проекта

- `bot.py` - основной файл с логикой бота
- `config.py` - конфигурация и загрузка переменных окружения
- `context_manager.py` - управление контекстом диалогов
- `api_client.py` - клиент для работы с ProxyAPI
- `prompts_manager.py` - управление заготовленными промптами из JSON
- `prompts.json` - файл с предустановленными промптами
- `.env` - файл с токенами (не загружается в Git)
- `requirements.txt` - зависимости проекта

## Используемые технологии

- Python 3.10+
- aiogram 3.0+
- openai (официальная библиотека)
- python-dotenv
- ProxyAPI для доступа к OpenAI API

## Результаты тестирования модели

| Модель | Temperature | Max Tokens | № прогона | Эффект (сжатость/креатив) | Использованные токены | Ориентировочная стоимость |
|--------|-------------|------------|-----------|---------------------------|----------------------|---------------------------|
| o4-mini-2025-04-16 | 0.7 | 1000 | 1 | Баланс между точностью и креативностью, ответы развернутые | ~150-300 токенов/запрос | ~0.001-0.003 руб/запрос |
| o4-mini-2025-04-16 | 0.7 | 1000 | 2 | Стабильные ответы, хорошее понимание контекста | ~200-400 токенов/запрос | ~0.002-0.004 руб/запрос |
| o4-mini-2025-04-16 | 0.5 | 500 | 3 | Более сжатые ответы, выше точность | ~100-250 токенов/запрос | ~0.001-0.002 руб/запрос |
| o4-mini-2025-04-16 | 1.0 | 1500 | 4 | Более креативные ответы, менее предсказуемые | ~300-600 токенов/запрос | ~0.003-0.006 руб/запрос |

**Примечание:**
- Все параметры настраиваются в файле `config.py`
- Реальная стоимость зависит от длины контекста и ответа
- Логи с детальной информацией о токенах сохраняются в консоли при работе бота
- ID запросов и статистику использования можно найти в кабинете ProxyAPI (https://proxyapi.ru)

## Логирование

Бот логирует следующую информацию:
- Параметры запросов (модель, количество сообщений, temperature, max_tokens)
- Использованные токены (prompt_tokens, completion_tokens, total_tokens)
- Ошибки при работе с API
- Статистику обработки сообщений пользователей

Все логи выводятся в консоль при работе бота.
